function init(){camera=new THREE.PerspectiveCamera(75,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4),camera.position.z=450,scene=new THREE.Scene,birds=[],boids=[];for(var i=0;100>i;i++)boid=boids[i]=new Boid,boid.position.x=400*Math.random()-200,boid.position.y=400*Math.random()-200,boid.position.z=400*Math.random()-200,boid.velocity.x=2*Math.random()-1,boid.velocity.y=2*Math.random()-1,boid.velocity.z=2*Math.random()-1,boid.setAvoidWalls(!0),boid.setWorldSize(500,500,400),bird=birds[i]=new THREE.Mesh(new Bird,new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide})),bird.phase=Math.floor(62.83*Math.random()),scene.add(bird);renderer=new THREE.CanvasRenderer,renderer.setClearColor(12658477),renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.getElementById("birds-container").appendChild(renderer.domElement),onWindowResize(),window.addEventListener("resize",onWindowResize,!1)}function scale(){var i=Math.max(document.body.clientWidth/window.innerWidth,document.body.clientHeight/window.innerHeight);return 1/i}function resize(){var i=scale();width=window.innerWidth,height=1>i?window.innerHeight*i:window.innerHeight,canvas.width=width,canvas.height=height}function onWindowResize(){scale();width=1024,height=640,camera.aspect=width/height,camera.updateProjectionMatrix(),renderer.setSize(width,height)}function onDocumentMouseMove(i){for(var t=new THREE.Vector3(i.clientX-SCREEN_WIDTH_HALF,-i.clientY+SCREEN_HEIGHT_HALF,0),o=0,e=boids.length;e>o;o++)boid=boids[o],t.z=boid.position.z,boid.repulse(t)}function animate(){requestAnimationFrame(animate),render()}function render(){for(var i=0,t=birds.length;t>i;i++)boid=boids[i],boid.run(boids),bird=birds[i],bird.position.copy(boids[i].position),color=16777215,color.r=color.g=color.b=(500-bird.position.z)/1e3,bird.rotation.y=Math.atan2(-boid.velocity.z,boid.velocity.x),bird.rotation.z=Math.asin(boid.velocity.y/boid.velocity.length()),bird.phase=(bird.phase+(Math.max(0,bird.rotation.z)+.1))%62.83,bird.geometry.vertices[5].y=bird.geometry.vertices[4].y=5*Math.sin(bird.phase);renderer.render(scene,camera)}var Bird=function(){function i(i,t,e){o.vertices.push(new THREE.Vector3(i,t,e))}function t(i,t,e){o.faces.push(new THREE.Face3(i,t,e))}var o=this;THREE.Geometry.call(this),i(5,0,0),i(-5,-2,1),i(-5,0,0),i(-5,-2,-1),i(0,2,-6),i(0,2,6),i(2,0,0),i(-3,0,0),t(0,2,1),t(4,7,6),t(5,6,7),this.computeFaceNormals()};Bird.prototype=Object.create(THREE.Geometry.prototype);var Boid=function(){var i,t,o=new THREE.Vector3,e=500,n=500,s=200,r=100,a=4,d=.1,h=!1;this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,i=new THREE.Vector3,this.setGoal=function(i){t=i},this.setAvoidWalls=function(i){h=i},this.setWorldSize=function(i,t,o){e=i,n=t,s=o},this.run=function(t){h&&(o.set(-e,this.position.y,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(e,this.position.y,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,-n,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,n,this.position.z),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,-s),o=this.avoid(o),o.multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,s),o=this.avoid(o),o.multiplyScalar(5),i.add(o)),Math.random()>.5&&this.flock(t),this.move()},this.flock=function(o){t&&i.add(this.reach(t,.005)),i.add(this.alignment(o)),i.add(this.cohesion(o)),i.add(this.separation(o))},this.move=function(){this.velocity.add(i);var t=this.velocity.length();t>a&&this.velocity.divideScalar(t/a),this.position.add(this.velocity),i.set(0,0,0)},this.checkBounds=function(){this.position.x>e&&(this.position.x=-e),this.position.x<-e&&(this.position.x=e),this.position.y>n&&(this.position.y=-n),this.position.y<-n&&(this.position.y=n),this.position.z>s&&(this.position.z=-s),this.position.z<-s&&(this.position.z=s)},this.avoid=function(i){var t=new THREE.Vector3;return t.copy(this.position),t.sub(i),t.multiplyScalar(1/this.position.distanceToSquared(i)),t},this.repulse=function(t){var o=this.position.distanceTo(t);if(150>o){var e=new THREE.Vector3;e.subVectors(this.position,t),e.multiplyScalar(.5/o),i.add(e)}},this.reach=function(i,t){var o=new THREE.Vector3;return o.subVectors(i,this.position),o.multiplyScalar(t),o},this.alignment=function(i){for(var t,o=new THREE.Vector3,e=0,n=0,s=i.length;s>n;n++)Math.random()>.6||(t=i[n],distance=t.position.distanceTo(this.position),distance>0&&r>=distance&&(o.add(t.velocity),e++));if(e>0){o.divideScalar(e);var a=o.length();a>d&&o.divideScalar(a/d)}return o},this.cohesion=function(i){for(var t,o,e=new THREE.Vector3,n=new THREE.Vector3,s=0,a=0,h=i.length;h>a;a++)Math.random()>.6||(t=i[a],o=t.position.distanceTo(this.position),o>0&&r>=o&&(e.add(t.position),s++));s>0&&e.divideScalar(s),n.subVectors(e,this.position);var c=n.length();return c>d&&n.divideScalar(c/d),n},this.separation=function(i){for(var t,o,e=new THREE.Vector3,n=new THREE.Vector3,s=0,a=i.length;a>s;s++)Math.random()>.6||(t=i[s],o=t.position.distanceTo(this.position),o>0&&r>=o&&(n.subVectors(this.position,t.position),n.normalize(),n.divideScalar(o),e.add(n)));return e}},SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,SCREEN_WIDTH_HALF=SCREEN_WIDTH/2,SCREEN_HEIGHT_HALF=SCREEN_HEIGHT/2,camera,scene,renderer,birds,bird,boid,boids;init(),animate();